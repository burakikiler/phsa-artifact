!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.CKEditor5=e():(t.CKEditor5=t.CKEditor5||{},t.CKEditor5.tooltip=e())}(self,(()=>(()=>{var t={"ckeditor5/src/core.js":(t,e,i)=>{t.exports=i("dll-reference CKEditor5.dll")("./src/core.js")},"ckeditor5/src/engine.js":(t,e,i)=>{t.exports=i("dll-reference CKEditor5.dll")("./src/engine.js")},"ckeditor5/src/typing.js":(t,e,i)=>{t.exports=i("dll-reference CKEditor5.dll")("./src/typing.js")},"ckeditor5/src/ui.js":(t,e,i)=>{t.exports=i("dll-reference CKEditor5.dll")("./src/ui.js")},"ckeditor5/src/utils.js":(t,e,i)=>{t.exports=i("dll-reference CKEditor5.dll")("./src/utils.js")},"ckeditor5/src/widget.js":(t,e,i)=>{t.exports=i("dll-reference CKEditor5.dll")("./src/widget.js")},"dll-reference CKEditor5.dll":t=>{"use strict";t.exports=CKEditor5.dll}},e={};function i(o){var s=e[o];if(void 0!==s)return s.exports;var n=e[o]={exports:{}};return t[o](n,n.exports,i),n.exports}i.d=(t,e)=>{for(var o in e)i.o(e,o)&&!i.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var o={};return(()=>{"use strict";i.d(o,{default:()=>v});var t=i("ckeditor5/src/core.js"),e=i("ckeditor5/src/ui.js"),s=i("ckeditor5/src/widget.js"),n=i("ckeditor5/src/engine.js");function r(t){return"object"!=typeof t?null:JSON.stringify(t)}function l(t,{writer:e}){"object"==typeof t&&(t=r(t));const i=e.createAttributeElement("span",{"data-tooltip":t},{priority:6});return e.setCustomProperty("tooltip",!0,i),i}function a(t,e){return!!t&&e.checkAttribute(t.name,"data-tooltip")}var c=i("ckeditor5/src/utils.js");class d extends e.View{_label="";constructor(i,o="Tooltip"){super(i),this.focusTracker=new c.FocusTracker,this.keystrokes=new c.KeystrokeHandler,this._focusables=new e.ViewCollection;const{t:s}=this;this._label=o,this.previewButtonView=this._createPreviewButton(),this.removeButtonView=this._createButton(s("Remove"),t.icons.eraser,"remove"),this.editButtonView=this._createButton(s(`Edit ${this._label.toLowerCase()}`),t.icons.pencil,"edit"),this.set("tooltip",void 0),this._focusCycler=new e.FocusCycler({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.setTemplate({tag:"div",attributes:{class:["ck","ck-link-actions","ck-responsive-form"],tabindex:"-1"},children:[this.previewButtonView,this.editButtonView,this.removeButtonView]})}render(){super.render();[this.previewButtonView,this.editButtonView,this.removeButtonView].forEach((t=>{this._focusables.add(t),this.focusTracker.add(t.element)})),this.keystrokes.listenTo(this.element)}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}_createButton(t,i,o=""){const s=new e.ButtonView(this.locale);return s.set({label:t,icon:i,tooltip:!0}),s.delegate("execute").to(this,o),s}_createPreviewButton(){const t=new e.LabelView(this.locale),{t:i}=this;return t.set({withText:!0}),t.extendTemplate({attributes:{class:"tooltip-label-label"}}),t.bind("text").to(this,"tooltip",(t=>t||i(`This has no ${this._label.toLowerCase()}`))),t.bind("isEnabled").to(this,"tooltip",(t=>!!t)),t.template&&(t.template.tag="span",t.template.eventListeners={}),t}}class h extends e.View{_label="";_labelHint="";constructor(i,o="Tooltip",s="Displays above selection."){super(i);const{t:n}=i;this._label=o,this._labelHint=s,this.focusTracker=new c.FocusTracker,this.keystrokes=new c.KeystrokeHandler,this._focusables=new e.ViewCollection,this.tooltipInputView=this._createTooltipInput(),this.saveButtonView=this._createButton(n("Save"),t.icons.check,"tooltip-button-save","submit"),this.saveButtonView.type="submit",this.cancelButtonView=this._createButton(n("Cancel"),t.icons.cancel,"tooltip-button-cancel","cancel"),this.children=this._createFormChildren(),this._focusCycler=new e.FocusCycler({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}});this.setTemplate({tag:"form",attributes:{class:["ck","ck-link-form","ck-responsive-form"],tabindex:"-1"},children:this.children})}render(){super.render(),(0,e.submitHandler)({view:this});[this.tooltipInputView,this.saveButtonView,this.cancelButtonView].forEach((t=>{this._focusables.add(t),this.focusTracker.add(t.element)})),this.keystrokes.listenTo(this.element)}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}focus(){this._focusCycler.focusFirst()}_createTooltipInput(){const t=this.locale?.t,i=new e.LabeledFieldView(this.locale,e.createLabeledInputText);return i.label=t(this._label),i.infoText=t(this._labelHint),i.fieldView.extendTemplate({attributes:{maxlength:250}}),i}_createButton(t,i,o,s=null){const n=new e.ButtonView(this.locale);return n.set({label:t,icon:i,tooltip:!0}),n.extendTemplate({attributes:{class:o}}),s&&n.delegate("execute").to(this,s),n}_createFormChildren(){const t=this.createCollection();return t.add(this.tooltipInputView),t.add(this.saveButtonView),t.add(this.cancelButtonView),t}}const u="tooltip-ui";function p(t){return t.getAncestors().find((t=>{return(e=t).is("attributeElement")&&!!e.getCustomProperty("tooltip");var e}))||null}class m extends t.Plugin{actionsView=null;formView=null;static get requires(){return[e.ContextualBalloon]}static get pluginName(){return"TooltipUI"}init(){const{editor:t}=this;t.editing.view.addObserver(n.ClickObserver),this._balloon=t.plugins.get(e.ContextualBalloon),this._createToolbarTooltipButton(),this._enableBallonActivators(),t.conversion.for("editingDowncast").markerToHighlight({model:u,view:{classes:["tooltip-fake-link-selection"]}}),t.conversion.for("editingDowncast").markerToElement({model:u,view:{name:"span",classes:["tooltip-fake-link-selection","tooltip-fake-link-selection_collapsed"]}})}destroy(){super.destroy(),this.formView&&this.formView.destroy(),this.actionsView&&this.actionsView.destroy()}_createViews(){this.actionsView=this._createActionsView(),this.formView=this._createFormView(),this._enableUserBalloonInteractions()}_createActionsView(){const{editor:t}=this,{config:e}=t,i=e.get("tooltip_label"),o=new d(t.locale,i),s=t.commands.get("add-tooltip"),n=t.commands.get("remove-tooltip");return o.bind("tooltip").to(s,"value",(t=>t?.content||"")),o.editButtonView.bind("isEnabled").to(s),o.removeButtonView.bind("isEnabled").to(n),this.listenTo(o,"edit",(()=>{this._addFormView()})),this.listenTo(o,"remove",(()=>{t.execute("remove-tooltip"),this._hideUI()})),o.keystrokes.set("Esc",((t,e)=>{this._hideUI(),e()})),o}_createFormView(){const{editor:t}=this,{config:e}=t,i=t.config.get("tooltip_label"),o=e.get("tooltip_hint"),s=new h(t.locale,i,o),n=t.commands.get("add-tooltip");return s.tooltipInputView.fieldView.bind("value").to(n,"value",(t=>t?.content||"")),s.tooltipInputView.bind("isEnabled").to(n,"isEnabled"),s.saveButtonView.bind("isEnabled").to(n),this.listenTo(s,"submit",(()=>{const{value:e}=s.tooltipInputView.fieldView.element;t.execute("add-tooltip",e),this._hideUI()})),this.listenTo(s,"cancel",(()=>{this._closeFormView()})),s.keystrokes.set("Esc",((t,e)=>{this._closeFormView(),e()})),s}_createToolbarTooltipButton(){const{editor:t}=this,{t:i,config:o}=t,s=o.get("tooltip_label")||"Tooltip",n=t.commands.get("add-tooltip");t.ui.componentFactory.add("tooltip",(t=>{const o=new e.ButtonView(t);return o.isEnabled=!0,o.label=i(`Insert ${s}`),o.icon='<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n\x3c!-- Created with Inkscape (http://www.inkscape.org/) --\x3e\n\n<svg\n   width="100mm"\n   height="100mm"\n   viewBox="0 0 100 100"\n   version="1.1"\n   id="svg1"\n   inkscape:version="1.3 (0e150ed6c4, 2023-07-21)"\n   sodipodi:docname="tooltip.svg"\n   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"\n   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"\n   xmlns="http://www.w3.org/2000/svg"\n   xmlns:svg="http://www.w3.org/2000/svg">\n  <sodipodi:namedview\n     id="namedview1"\n     pagecolor="#505050"\n     bordercolor="#eeeeee"\n     borderopacity="1"\n     inkscape:showpageshadow="0"\n     inkscape:pageopacity="0"\n     inkscape:pagecheckerboard="0"\n     inkscape:deskcolor="#505050"\n     inkscape:document-units="mm"\n     inkscape:zoom="1.4485269"\n     inkscape:cx="249.56388"\n     inkscape:cy="154.98504"\n     inkscape:window-width="1920"\n     inkscape:window-height="1009"\n     inkscape:window-x="1912"\n     inkscape:window-y="-8"\n     inkscape:window-maximized="1"\n     inkscape:current-layer="layer1" />\n  <defs\n     id="defs1" />\n  <g\n     inkscape:label="Layer 1"\n     inkscape:groupmode="layer"\n     id="layer1">\n    <path\n       style="color:#000000;fill:none;stroke:#000000;stroke-width:7;stroke-dasharray:none;stroke-opacity:1"\n       d="M 50.094147,9.7761689 C 6.09149,9.9588259 6.7081878,10.050466 6.1716371,50.593716 5.6236666,91.999877 26.841825,66.849382 41.326619,81.547 c 1.218787,1.236694 -0.0054,0.0053 8.549832,10.78188 C 59.102041,81.570413 57.263029,83.020251 59.110245,81.547 77.048607,67.240225 94.564627,92.432311 94.199313,50.593716 93.846772,10.217914 94.096803,9.5935119 50.094147,9.7761689 Z"\n       id="path1"\n       sodipodi:nodetypes="zsscssz" />\n    <path\n       style="color:#000000;fill:#000000;fill-opacity:1;stroke:#000000;stroke-width:1;stroke-dasharray:none;stroke-opacity:1"\n       d="m 45.613866,40.138047 v 0.708329 27.87939 h 9.050563 V 40.138047 Z"\n       id="rect2"\n       sodipodi:nodetypes="cccccc" />\n    <path\n       style="color:#000000;fill:#000000;fill-opacity:1;stroke:#000000;stroke-width:0.609043;stroke-dasharray:none;stroke-opacity:1"\n       d="m 45.259504,25.039676 v 0.251863 9.913161 h 9.441521 V 25.039676 Z"\n       id="rect2-9"\n       sodipodi:nodetypes="cccccc" />\n  </g>\n</svg>\n',o.tooltip=!0,o.isToggleable=!0,o.bind("isEnabled").to(n,"isEnabled"),o.bind("isOn").to(n,"value",(t=>!!t)),this.listenTo(o,"execute",(()=>this._showUI(!0))),o}))}_enableBallonActivators(){const{editor:t}=this,e=t.editing.view.document;this.listenTo(e,"click",(()=>{this._getSelectedTooltipElement()&&this._showUI()}))}_enableUserBalloonInteractions(){this.editor.keystrokes.set("Tab",((t,e)=>{this._areActionsVisible&&!this.actionsView?.focusTracker.isFocused&&(this.actionsView?.focus(),e())}),{priority:"high"}),this.editor.keystrokes.set("Esc",((t,e)=>{this._isUIVisible&&(this._hideUI(),e())})),(0,e.clickOutsideHandler)({emitter:this.formView,contextElements:[this._balloon.view.element],activator:()=>this._isUIVisible,callback:()=>this._hideUI()})}_addActionsView(){this.actionsView||this._createViews(),this._areActionsInPanel||this._balloon.add({view:this.actionsView,position:this._getBalloonPositionData()})}_addFormView(){if(this.formView||this._createViews(),this._isFormInPanel)return;const{editor:t}=this,e=t.commands.get("add-tooltip");this._balloon.add({view:this.formView,position:this._getBalloonPositionData()}),this._balloon.visibleView===this.formView&&this.formView.tooltipInputView.fieldView.select(),this.formView.tooltipInputView.fieldView.element.value=e.value?.content||""}_closeFormView(){void 0!==this.editor.commands.get("add-tooltip").value?this._removeFormView():this._hideUI()}_removeFormView(){this._isFormInPanel&&(this.formView.saveButtonView.focus(),this._balloon.remove(this.formView),this.editor.editing.view.focus())}_showUI(t=!1){this.formView||this._createViews(),this._getSelectedTooltipElement()?(this._areActionsVisible?this._addFormView():this._addActionsView(),t&&this._balloon.showStack("main")):(this._addActionsView(),t&&this._balloon.showStack("main"),this._addFormView()),this._startUpdatingUI()}_hideUI(){if(!this._isUIInPanel)return;const{editor:t}=this;this.stopListening(t.ui,"update"),this.stopListening(this._balloon,"change:visibleView"),t.editing.view.focus(),this._removeFormView(),this._balloon.remove(this.actionsView),this.formView=null,this.actionsView=null}_startUpdatingUI(){const{editor:t}=this,e=t.editing.view.document;function i(){return e.selection.focus.getAncestors().reverse().find((t=>t.is("element")))}let o=this._getSelectedTooltipElement(),s=i();const n=()=>{const t=this._getSelectedTooltipElement(),e=i();o&&!t||!o&&e!==s?this._hideUI():this._isUIVisible&&this._balloon.updatePosition(this._getBalloonPositionData()),o=t,s=e};this.listenTo(t.ui,"update",n),this.listenTo(this._balloon,"change:visibleView",n)}get _isFormInPanel(){return!!this.formView&&this._balloon.hasView(this.formView)}get _areActionsInPanel(){return!!this.actionsView&&this._balloon.hasView(this.actionsView)}get _areActionsVisible(){return!!this.actionsView&&this._balloon.visibleView===this.actionsView}get _isUIInPanel(){return this._isFormInPanel||this._areActionsInPanel}get _isUIVisible(){const{visibleView:t}=this._balloon;return!!this.formView&&t==this.formView||this._areActionsVisible}_getBalloonPositionData(){const{view:t}=this.editor.editing,{model:e}=this.editor,i=t.document;let o=null;if(e.markers.has(u)){const e=Array.from(this.editor.editing.mapper.markerNameToElements(u)),i=t.createRange(t.createPositionBefore(e[0]),t.createPositionAfter(e[e.length-1]));o=t.domConverter.viewRangeToDom(i)}else o=()=>{const e=this._getSelectedTooltipElement();return e?t.domConverter.mapViewToDom(e):t.domConverter.viewRangeToDom(i.selection.getFirstRange())};return{target:o}}_getSelectedTooltipElement(){const{view:t}=this.editor.editing,{selection:e}=t.document,i=e.getSelectedElement();if(e.isCollapsed||i&&(0,s.isWidget)(i))return p(e.getFirstPosition());if(e.getFirstRange()){const i=e.getFirstRange().getTrimmed(),o=p(i.start),s=p(i.end);if(!o||o!==s)return null;if(t.createRangeIn(o).getTrimmed().isEqual(i))return o}return null}}var w=i("ckeditor5/src/typing.js");function f(t){if(t.isCollapsed){const e=t.getFirstPosition();return e?e.textNode&&e.textNode.data:null}if(!t.getFirstRange())return null;const e=Array.from(t.getFirstRange().getItems());if(e.length>1)return null;const i=e[0];return i.is("$text")||i.is("$textProxy")?i.data:null}class g extends t.Command{value=void 0;refresh(){const{model:t}=this.editor,{selection:e}=t.document,i=e.getSelectedElement()||(0,c.first)(e.getSelectedBlocks());a(i,t.schema)?(this.value=i.getAttribute("data-tooltip"),this.isEnabled=t.schema.checkAttribute(i,"data-tooltip")):(this.value=e.getAttribute("data-tooltip"),this.isEnabled=t.schema.checkAttributeInSelection(e,"data-tooltip")),this.value&&(this.value=function(t){if("string"!=typeof t||0===t.length||!t.startsWith("{"))return null;try{return JSON.parse(t)}catch{return null}}(this.value))}execute(t){const{model:e}=this.editor,{selection:i}=e.document;t=r({content:t}),e.change((o=>{if(i.isCollapsed){const s=i.getFirstPosition();if(i.hasAttribute("data-tooltip")){const n=f(i);let r=(0,w.findAttributeRange)(s,"data-tooltip",i.getAttribute("data-tooltip"),e);i.getAttribute("data-tooltip")===n&&(r=this._updateTooltipContent(e,o,r,t)),o.setAttribute("data-tooltip",t,r),o.setSelection(o.createPositionAfter(r.end.nodeBefore))}else if(""!==t){const n=(0,c.toMap)(i.getAttributes());n.set("data-tooltip",t);const{end:r}=e.insertContent(o.createText(t,n),s);o.setSelection(r)}["data-tooltip"].forEach((t=>{o.removeSelectionAttribute(t)}))}else{const s=e.schema.getValidRanges(i.getRanges(),"data-tooltip"),n=[];for(const t of i.getSelectedBlocks())e.schema.checkAttribute(t,"data-tooltip")&&n.push(o.createRangeOn(t));const r=n.slice();for(const t of s)this._isRangeToUpdate(t,n)&&r.push(t);for(const s of r){let n=s;if(1===r.length){const r=f(i);i.getAttribute("data-tooltip")===r&&(n=this._updateTooltipContent(e,o,s,t),o.setSelection(o.createSelection(n)))}o.setAttribute("data-tooltip",t,n)}}}))}_isRangeToUpdate(t,e){for(const i of e)if(i.containsRange(t))return!1;return!0}_updateTooltipContent(t,e,i,o){const s=e.createText(o,{"data-tooltip":o});return t.insertContent(s,i)}}class b extends t.Command{refresh(){const{model:t}=this.editor,{selection:e}=t.document,i=e.getSelectedElement();a(i,t.schema)?this.isEnabled=t.schema.checkAttribute(i,"data-tooltip"):this.isEnabled=t.schema.checkAttributeInSelection(e,"data-tooltip")}execute(){const{editor:t}=this,{model:e}=t,{selection:i}=e.document;e.change((t=>{const o=i.isCollapsed?[(0,w.findAttributeRange)(i.getFirstPosition(),"data-tooltip",i.getAttribute("data-tooltip"),e)]:e.schema.getValidRanges(i.getRanges(),"data-tooltip");for(const e of o)t.removeAttribute("data-tooltip",e)}))}}class _ extends t.Plugin{static get requires(){return[s.Widget]}init(){this._defineScheme(),this._defineConverters(),this.editor.commands.add("add-tooltip",new g(this.editor)),this.editor.commands.add("remove-tooltip",new b(this.editor))}_defineScheme(){const{schema:t}=this.editor.model;t.extend("$text",{allowAttributes:"data-tooltip"})}_defineConverters(){const{editor:t}=this;t.conversion.for("dataDowncast").attributeToElement({model:"data-tooltip",view:l}),t.conversion.for("editingDowncast").attributeToElement({model:"data-tooltip",view:(t,e)=>l(t,e)}),t.conversion.for("upcast").elementToAttribute({view:{name:"span",attributes:{"data-tooltip":!0}},model:{key:"data-tooltip",value:t=>t.getAttribute("data-tooltip")}})}}class k extends t.Plugin{static get requires(){return[_,m]}static get pluginName(){return"Tooltip"}}const v={Tooltip:k}})(),o=o.default})()));